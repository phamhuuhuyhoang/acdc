Version 4
SHEET 1 3172 1692
WIRE -80 64 -96 64
WIRE -64 64 -80 64
WIRE 288 64 176 64
WIRE 320 64 288 64
WIRE 448 64 400 64
WIRE 512 64 448 64
WIRE 592 64 512 64
WIRE 720 64 672 64
WIRE 800 64 720 64
WIRE 448 96 448 64
WIRE -64 128 -64 64
WIRE 176 128 176 64
WIRE 448 192 448 160
WIRE 64 256 64 224
WIRE 64 272 64 256
WIRE 1728 496 1696 496
WIRE 1840 496 1808 496
WIRE 2032 496 1840 496
WIRE 352 576 320 576
WIRE 384 576 352 576
WIRE 400 576 384 576
WIRE 496 576 480 576
WIRE 512 576 496 576
WIRE 608 576 592 576
WIRE 1872 592 1840 496
WIRE 1904 592 1872 592
WIRE 384 608 384 576
WIRE 496 608 496 576
WIRE 2000 608 1968 608
WIRE 2096 608 2032 496
WIRE 2096 608 2064 608
WIRE 2192 608 2096 608
WIRE 2240 608 2192 608
WIRE 400 624 384 608
WIRE 480 624 496 608
WIRE 1904 624 1872 624
WIRE 400 656 400 624
WIRE 480 656 480 624
WIRE -176 672 -208 672
WIRE -112 672 -176 672
WIRE -48 672 -112 672
WIRE 48 672 32 672
WIRE 160 672 48 672
WIRE 1840 688 1872 624
WIRE 1840 688 1808 688
WIRE -112 704 -112 672
WIRE 48 704 48 672
WIRE 160 704 160 672
WIRE 240 720 320 576
WIRE 240 720 208 720
WIRE 944 720 928 720
WIRE 976 720 944 720
WIRE 928 736 928 720
WIRE 1872 752 1840 688
WIRE 1904 752 1872 752
WIRE 1936 752 1904 752
WIRE 240 768 208 768
WIRE 320 896 240 768
WIRE 352 896 320 896
WIRE 512 896 352 896
WIRE 640 896 592 896
WIRE 2256 896 2256 864
WIRE 2304 896 2304 864
WIRE 2224 928 2256 896
WIRE 2336 928 2304 896
WIRE 1952 976 1872 976
WIRE 2000 976 1952 976
WIRE 2064 976 2000 976
WIRE 2192 976 2176 976
WIRE 2224 976 2224 928
WIRE 2224 976 2192 976
WIRE 2240 976 2224 976
WIRE 2336 976 2336 928
WIRE 2336 976 2320 976
WIRE 2352 976 2336 976
WIRE 2496 976 2432 976
WIRE 1952 1008 1952 976
WIRE 2064 1008 2064 976
WIRE 2192 1008 2192 976
WIRE 2144 1024 2176 976
WIRE 2144 1024 2112 1024
WIRE 2144 1072 2112 1072
WIRE 2176 1120 2144 1072
WIRE 2192 1120 2192 1088
WIRE 2192 1120 2176 1120
WIRE 2304 1120 2192 1120
WIRE 2416 1120 2384 1120
FLAG 176 208 0
FLAG 288 64 SW
FLAG -96 64 IN
IOPIN -96 64 BiDir
FLAG 800 64 OUT
IOPIN 800 64 BiDir
FLAG 64 352 0
FLAG 64 256 d
FLAG 720 64 OUT
FLAG 400 656 B
IOPIN 400 656 BiDir
FLAG 480 656 A
IOPIN 480 656 BiDir
FLAG 448 192 0
FLAG -208 672 ctl
IOPIN -208 672 Out
FLAG -80 64 IN
FLAG 512 64 Vox
FLAG 64 224 d
IOPIN 64 224 Out
FLAG 640 896 0
FLAG -64 208 0
FLAG 1728 688 0
FLAG 1936 752 ISNS
IOPIN 1936 752 Out
FLAG 1904 752 ISNS
FLAG 2496 976 ISNS
FLAG 2240 608 48VLS
IOPIN 2240 608 BiDir
FLAG 2304 864 AI
IOPIN 2304 864 BiDir
FLAG 688 576 0
FLAG 1872 976 ictl
IOPIN 1872 976 BiDir
FLAG 352 576 VFB
FLAG 352 896 Vref
FLAG 160 784 0
FLAG -176 672 ctl
FLAG 48 784 0
FLAG 2064 1088 0
FLAG 1952 1088 0
FLAG 1744 288 VCC
FLAG 1744 368 0
FLAG 2192 608 48VLS
FLAG 2256 864 BI
IOPIN 2256 864 BiDir
FLAG 1696 496 0
FLAG 2000 976 ictl
FLAG 2496 1120 0
FLAG 944 720 EN
FLAG 976 720 EN
IOPIN 976 720 BiDir
FLAG 928 816 0
FLAG 1936 576 VCC
FLAG 1936 640 0
SYMBOL ind 304 80 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lo}
SYMATTR SpiceLine Rser={RLm}
SYMBOL cap 432 96 R0
SYMATTR InstName C1
SYMATTR Value {Co}
SYMATTR SpiceLine Rser={RCo}
SYMBOL bv 176 112 R0
SYMATTR InstName B1
SYMATTR Value V=V(IN)/8*V(d)
SYMBOL res 608 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1m
SYMBOL res 496 560 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsns
SYMATTR Value 50
SYMBOL bv 64 256 R0
WINDOW 3 -260 81 Left 2
SYMATTR Value V=limit(V(ctl),0,1)
SYMATTR InstName B3
SYMBOL bi -64 128 R0
WINDOW 3 -197 69 Left 2
SYMATTR Value I=-I(B1)*V(d)
SYMATTR InstName B2
SYMBOL bv 1824 688 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 71 24 VTop 2
SYMATTR InstName B4
SYMATTR Value V=I(VSNS)*igain
SYMBOL voltage 576 64 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VSNS
SYMATTR Value 0
SYMBOL res 2336 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 50
SYMBOL res 2448 960 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 1m
SYMBOL bv 592 576 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -39 148 VBottom 2
SYMATTR InstName B6
SYMATTR Value V=(V(OUT))*vgain
SYMBOL bv 496 896 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 VBottom 2
SYMATTR InstName B7
SYMATTR Value V=((vsetpt-I(VSNS)*droop)*vgain+V(ictl))*V(EN)
SYMBOL res 2400 1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 50
SYMBOL g2 160 688 M0
WINDOW 3 -605 64 Left 2
SYMATTR Value Laplace=(s/wz1+1)/((s/wp0+1)*(s/wp1+1))
SYMATTR InstName G1
SYMBOL res 32 688 R0
SYMATTR InstName R1
SYMATTR Value {G0}
SYMBOL g2 2064 992 M0
WINDOW 3 -165 176 Left 2
SYMATTR Value Laplace=1/((s/wp0+1)*(s/wp1+1))
SYMATTR InstName G2
SYMBOL res 1936 992 R0
SYMATTR InstName R3
SYMATTR Value {iG0}
SYMBOL voltage 1744 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL res 1824 480 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL res 48 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1
SYMBOL bv 2400 1120 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -37 149 VBottom 2
SYMATTR InstName B5
SYMATTR Value V=min(V(48VLS),vimx)*V(EN)
SYMBOL res 2176 992 R0
SYMATTR InstName R6
SYMATTR Value 1Meg
SYMBOL res 912 720 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL OpAmps\\OP491 1936 544 R0
SYMATTR InstName U1
SYMBOL diode 2000 624 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 -3 87 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N4148
TEXT 424 288 Left 2 !.param Lo=1u
TEXT 424 312 Left 2 !.param Co=30m
TEXT 280 1224 Left 2 !.param fz2=600
TEXT 280 1256 Left 2 !.param fp0=10
TEXT 280 1288 Left 2 !.param fp1=20k
TEXT 280 1320 Left 2 !.param fp2=10000
TEXT 280 1192 Left 2 !.param fz1=0.75*flc
TEXT 280 1160 Left 2 !.param G0=100
TEXT 928 -8 Left 2 ;phamhuuhuyhoang0@
TEXT -32 8 Left 3 ;POWERTRAIN
TEXT -184 496 Left 3 ;VLOOP
TEXT 928 32 Left 2 ;generic forward topology in continuous conduction mode with compensation\napplicable for:\nnon-isolated forward/buck\nisolated forward\nphase shifted full bridge
TEXT 632 288 Left 2 !.param RLm=5m
TEXT 632 312 Left 2 !.param RCo=2.5m
TEXT 1760 1216 Left 2 ;current loop adjustment
TEXT 2664 560 Left 2 !.param ifp0 = 10
TEXT 2664 624 Left 2 !.param ifp1=100
TEXT 2664 592 Left 2 !.param ifz1=10k
TEXT 2480 488 Left 3 ;ILOOP
TEXT 2664 528 Left 2 !.param iG0=1
TEXT 280 1064 Left 2 !.param vgain=vrefmax/vsetpt
TEXT 280 1096 Left 2 !.param vsetpt=52
TEXT 536 1160 Left 2 !.param wz1=fz1*2*3.14
TEXT 536 1192 Left 2 !.param wz2=fz2*2*3.14
TEXT 536 1232 Left 2 !.param wp0=fp0*2*3.14
TEXT 536 1264 Left 2 !.param wp1=fp1*2*3.14
TEXT 536 1296 Left 2 !.param wp2=fp2*2*3.14
TEXT 424 352 Left 2 !.param flc=1/(2*3.14*sqrt(Lo*Co))
TEXT 424 384 Left 2 !.param fCesr=1/(2*3.14*RCo*Co)
TEXT 2664 664 Left 2 !.param iwp0=ifp0*2*3.14
TEXT 2664 696 Left 2 !.param iwz1=ifz1*2*3.14
TEXT 2664 728 Left 2 !.param iwp1=ifp1*2*3.14
TEXT 280 1032 Left 2 !.param droop=0.015
TEXT 280 1000 Left 2 !.param vrefmax=6
TEXT 2664 768 Left 2 !.param Imax=100
TEXT 2664 872 Left 2 !.param igain=vimx/Imax
TEXT 2664 808 Left 2 !.param vimx=10
RECTANGLE Normal 896 432 -320 -32 2
RECTANGLE Normal 1568 1392 -320 464 2
RECTANGLE Normal 3168 1392 1648 464 2
